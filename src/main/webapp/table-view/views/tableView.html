<div class="breadcrumbs-wrapper">
	<a href="#/">My Projects</a>
	<a href="#/project/{{project.projectId}}">{{project.name}}</a>
	<a href="#/project/{{project.projectId}}/{{projectDatabase.logicalDatabaseId}}">{{projectDatabase.dbName}}</a>
	<span class="breadcrumbs youarehere">Data Viewer</span>
</div>
<h1 ng-if="queryType=='table'">Table Name: {{tableName}}</h1>
<h1 ng-if="queryType=='SQL'">Query: {{theQuery}}</h1>
<h1 ng-if="queryType=='dataset'">Dataset: {{tableView.viewName}}</h1>
<!-- pagination -->
<table>
<tr>
	<td ng-if="startRow > 1"><button class="button" ng-click="loadPrevious()">Previous</button></td>
	<td>Records #:{{startRow}} to {{lastRow}} of {{maxRows}}</td>
	<td ng-if="lastRow < maxRows"><button class="button" ng-click="loadNext()">Next</button></td>
	<td>Page: {{pagePosition}} of {{pages}}</td>
	<td>Go to record: <input type="number" ng-model="newStart"  ng-keyup="$event.keyCode == 13 && startFrom()"/></td>
</tr>
</table>
<div class="contDiv">
	<div class="headerDiv">
		<table class="data-table" style="table-layout: fixed; width: 100%">
			<thead>
				<tr>
					<td class="tdFixed" ng-repeat="column in tableData.columnsByIndex">
						<div ng-if="!column.referencedTable"
							class="colHead"
							ng-click="orderKey(column.columnName)">
							{{column.columnName}}
							<span ng-show="orderProp == column.columnName && !sortReverse">&nbsp;&darr;</span>
							<span ng-show="orderProp == column.columnName && sortReverse">&nbsp;&uarr;</span>
						</div>
						<p ng-if="column.referencedTable" class="referenceSelect">
							<select class="changeReferencedColumnData"
								id="{{column.columnName}}___referencedTableColumnSelect"
								name="{{column.columnName}}___referencedTableColumnSelect"
								ng-model="columnSelection[column.referencedTable]"
								ng-change="selectTableReference(column.columnName, column.referencedTable)"
								>
								<option ng-repeat="alternate in column.alternateColumns" value="{{alternate}}">{{alternate}}</option>
							</select>
						</p>
					</td>
					<td ng-if="queryType == 'table'" class="tdFixed" style="width:100px;">Functions</td>
				</tr>
			</thead>
			<tbody></tbody>
		</table>
	</div>
	<div class="bottomDiv" fix-on-scroll fixed-div=".headerDiv">
		<form class="table-data-form" name="dataForm">
		<table style="table-layout: fixed; width: 100%">
			<tbody>
				<tr ng-repeat="row in tableData.rows | filter:doFilter | orderBy:sortBy:sortReverse" repeat-end="tableLoaded()">
					<td class="tdScroll" ng-repeat="column in tableData.columnsByIndex">

					<span ng-if="!column.referencedTable">
						<input type="text" name="input_{{row.cell[primaryKey].value}}_{{column.columnName}}" 
							ng-if="!checkPrimaryColumn(column) && queryType == 'table'" 
							ng-model="row.cell[column.columnName].value"
							ng-change="valueChanged(row.cell[column.columnName])"/>
						<span ng-if="checkPrimaryColumn(column) || queryType!=='table'">{{row.cell[column.columnName].value}}</span>
					</span>

					<big-select ng-if="column.referencedTable" 
						type="text" 
						readonly="{{queryType == 'table'}}"
						reference-key="{{row.cell[primaryKey].value}}"
						class="selectedDataItem {{column.columnName}} bigdrop"
						id="selectedDataItemForTableRow_{{row.cell[primaryKey].value}}_{{column.columnName}}"
						referenced-column="referencedColumn[column.referencedTable]"
						referenced-table="{{column.referencedTable}}"
						referenced-label="null"/>

					</td>
					<td ng-if="queryType == 'table'" class="tdScroll" style="min-width:100px; width:100px;">
						<button class="button delete" ng-really-message="Are you sure you want to delete this row?" ng-really-click="deleteRow(row)">Delete</button>
					</td>
				</tr>
			</tbody>
		</table>
		</form>
	</div>
</div>
<div ng-if="queryType=='SQL'"><a class="button" ng-click="saveAsView()">Save As Dataset</a></div>
<div ng-if="queryType=='table'" ><a class="button" ng-disabled="!dataForm.$dirty" ng-click="saveChangedRows()">Save Changes</a></div>

<addrow ng-show="queryType=='table'"></addrow>

<div class=filterArea>Filter: 
<select ng-model="filterField">
<option ng-repeat="column in tableData.columnsByIndex">{{column.columnName}}</option>
</select>
<select ng-model="filterType">
	<option value="is">is</option>
	<option value="is not">is not</option>
	<option value="like">like</option>
	<option value="contains">contains</option>
	<option value="is NULL">is NULL</option>
</select>
<input ng-model="filterValue"/>
</div>